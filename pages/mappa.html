<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mappa della Campagna</title>
<link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cardo&display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    font-family: 'Cardo', serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: #f6f1e1 url('parchment-bg.jpg') repeat; /* Sfondo pergamena */
    color: #3b2f1c;
  }
  header {
    background: #5c3b1e;
    color: white;
    padding: .6rem 1rem;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 1rem;
    font-family: 'MedievalSharp', cursive;
    border-bottom: 4px solid #d4af37; /* Bordo dorato */
  }
  header a {
    color: #f3e5ab;
    text-decoration: none;
    font-weight: bold;
  }
  header a:hover {
    text-decoration: underline;
    color: #ffd700;
  }

  /* --- PULSANTE MENU (minima aggiunta) --- */
  #menuToggle {
    margin-left: auto; /* spinge il bottone a destra */
    background: linear-gradient(#ffd97a, #d4af37);
    border: 2px solid rgba(0,0,0,0.15);
    color: #3b2f1c;
    padding: .25rem .6rem;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    display: inline-flex;
    align-items: center;
    gap: .4rem;
  }
  #menuToggle:active { transform: translateY(1px); }

  .container {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  /* quando la container ha questa classe, nascondiamo l'aside */
  .container.menu-closed aside {
    display: none;
  }

  aside {
    width: 250px;
    background: rgba(60, 40, 20, 0.9);
    color: white;
    padding: 1rem;
    overflow-y: auto;
    border-right: 4px solid #d4af37;
  }
  aside h2 {
    margin-top: 0;
    font-family: 'MedievalSharp', cursive;
    color: #ffd700;
  }
  aside ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  aside li {
    padding: .5rem;
    cursor: pointer;
    border-radius: .3rem;
    transition: background 0.2s;
  }
  aside li:hover {
    background: rgba(255, 215, 0, 0.2);
  }
  main {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
  }
  main h1 {
    font-family: 'MedievalSharp', cursive;
    color: #5c3b1e;
    margin-top: 0;
  }
  .place-image {
    width: 100%;
    max-height: 300px;
    object-fit: cover;
    border: 3px solid #d4af37;
    margin-bottom: 1rem;
    border-radius: 5px;
  }
  .section {
    margin-bottom: 1rem;
    padding: .8rem;
    background: rgba(255, 255, 255, 0.85);
    border-radius: .5rem;
    border: 2px solid #d4af37;
    box-shadow: 0 1px 6px rgba(0,0,0,0.2);
  }
  .section h3 {
    margin-top: 0;
    font-family: 'MedievalSharp', cursive;
    color: #5c3b1e;
  }

  /* Stile per elenco Luoghi Importanti: nome sottolineato solo qui */
  .luoghi-list { margin: 0 0 0 1rem; padding-left: 0; }
  .luoghi-list li { margin-bottom: .6rem; }
  .luogo-name { text-decoration: underline; font-weight: normal; display: inline-block; margin-bottom: 6px; color: #3b2f1c; }
  .luogo-desc { margin: 6px 0 0 0; color: #3b2f1c; }

  /* --- Mobile --- */
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
    }
    aside {
      width: 100%;
      max-height: 200px;
    }
    /* su mobile il pulsante rimane visibile; portalo più evidente */
    #menuToggle {
      margin-left: 0;
      order: 1;
    }
  }
</style>
</head>
<body>

<header>
  <a href="../index.html">Home</a>
  <a href="personaggi.html">Personaggi</a>
  <a href="lore.html">Lore</a>
  <a href="mappa.html">Mappa</a>

  <!-- pulsante di toggle aggiunto (minima modifica) -->
  <button id="menuToggle" aria-expanded="true" aria-controls="placesList">☰ Luoghi</button>
</header>

<div class="container" id="container">
  <aside>
    <h2>Luoghi</h2>
    <ul id="placesList"></ul>
  </aside>

  <main>
    <div id="placeDetails">
      <h1>Seleziona un luogo</h1>
      <p>Dall’elenco a sinistra (o sopra, su mobile).</p>
    </div>
  </main>
</div>

<script>
  const places = [
    {
      name: "Vingaldrum",
      image: "../assets/vingaldrum.png",
      sections: {
        "Storia": "Anticamente, Ethelindor ed i suoi compagni giunsero nel Nord, per cercare una nuova terra. Arrivati dinanzi all'Albero Cantante, l'elfo condottiero fu messo alla prova dalla Dea Thalindra. Fronteggiò e sconfisse il Guardiano dell'albero. Fu così che divenne campione di Thalindra, e la dea gli donò una gemma verde: attorno ad essa sarebbe sorta la città. Nacque dapprima Velarithan, la Città delle Radici. Lì, gli elfi iniziarono a costruire case, centri, di quello che era soltanto un modesto villaggio.\n\nNacque Vingaldrum nel giorno in cui Ethelindor ampliò i confini sui Monti dei Saggi: lì fu costruito il Palazzo di Ethelindor e ufficialmente incoronato il primo re degli elfi.\n\nPochi anni dopo, con l'avvento di Valdenor, scoppiò una guerra tra i due elfi e le due città: Vingaldrum fu quasi interamente distrutta, Ethelindor e i suoi uomini si rifugiarono a Velarithan. A fine guerra, però, Ethelindor riuscì nel contrattacco e Vingaldrum ne emerse vittoriosa.\n\nAd Ethelindor successe al trono la sorella Ethelindra, che guidò con saggezza ed eleganza il suo popolo. Al contrario del fratello, che fu più un condottiero valoroso, Ethelindra fu da sempre un'abile negoziatrice, che portò Vingaldrum allo splendore.\n\nDopo la morte di Ethelindra, salì al trono Lae'Noriel. In un periodo in cui i Cappucci Grigi iniziavano a mettere i bastoni fra le ruote della città, Lae'Noriel fronteggiò la minaccia diplomatica di Goldbrick: volendo mantenere a tutti i costi l'indipendenza, Vingaldrum fu la prima città occupata con la forza da Nuova Fost.",
        "Geografia": "Vingaldrum si trova a 2 giorni di viaggio verso sud da Khar Durim e 4 da Goldbrick. E' attraversata da un lungo fiume, che nasce dai Monti Ogalduk e sfocia nel Mare senza Traccia. Si estende sui Monti dei Saggi, due colli uno accanto all'altro.",
        "Organizzazioni e Fazioni": "Vingaldrum è governata dal Lord d'Argento. Monarchia ereditaria, è il Re a scegliere il suo successore al trono. I sovrani sono affiancati da un consigliere (ora Mythalor). Per molto tempo fu importante all'interno di Vingaldrum la fazione dei Cappucci Grigi: elfi che si rifacevano a Tal'Noriel e desideravano l'indipendenza incondizionata della città dalla pesante burocrazia di Nuova Fost. La fazione dei Cappucci Grigi era capitanata da Tal'Noriel e, con la sua morte, è andata a disperdersi. \n\nGli Archivisti di Luce sono gli studiosi della Biblioteca di Velarithan. Fanno parte del ceto nobile della città elfica. \n\nL'Ordine delle Staffe Seratine è l'ordine di maghi ed incantatori che ha sede nella Torre di Velyanor. \n\nGli apprendisti del Canto Sacro fanno parte di un ordine che non è nativo di Vingaldrum.",
        "Luoghi Importanti": [
          {
            name: "Palazzo di Ethelindor",
            description: "Imponente castello che domina Vingaldrum, sede del potere reale. Sale decorate con intarsi che raccontano la fondazione della città; terrazze che guardano i boschi. Centro amministrativo e giudiziario: qui si svolgono udienze pubbliche, consigli di guerra, negoziati diplomatici e cerimonie. Residenza ufficiale del Re Lae'Noriel."
          },
          {
            name: "Casa delle Rose",
            description: "Dimora malinconica e curata, preceduta da un giardino di rose sempre fiorite. Era la residenza di Ethelindra, la regina madre; oggi è mantenuta come memoriale e luogo di contemplazione, oltre che deposito di lettere e ricordi di corte."
          },
          {
            name: "Forgiargento",
            description: "Grande bottega-forgia vicina alla Piazza Centrale, gestita da Thalion. Qui si producono e riparano armi, armature e utensili; luogo d'incontro per mercanti e avventurieri e spazio di apprendistato per giovani fabbri."
          },
          {
            name: "Altarion",
            description: "Enorme complesso sacro dedicato a Thalindra, situato poco prima dei Monti dei Saggi. Un tempo giardino di luce; oggi al centro sorge il Kurkhael, lascito della Battaglia Fantasma. Luogo di riti sacri, cerimonie stagionali, veglie e funzioni di guarigione."
          },
          {
            name: "Biblioteca di Velarithan",
            description: "Colossale archivio di pergamene, volumi rilegati e tomi magici: sede degli Archivisti di Luce. Qui si svolgono ricerca accademica, studio e catalogazione della storia elfica."
          },
          {
            name: "Velarithan",
            description: "La città antica dalla quale nacque Vingaldrum: insieme di edifici vecchi che custodiscono memoria e archivi. Non ha punti di interesse moderni come la capitale, ma resta nucleo storico e culturale."
          },
          {
            name: "Albero Cantante",
            description: "Antico albero qualche chilometro fuori città, si dice sia il primo a risvegliarsi, e a cullare con il suo canto tutto il bosco. Meta di pellegrinaggi e degli apprendisti del Canto Sacro; luogo di prove spirituali e riti d'iniziazione. Protetto dal temibile Guardiano legato a Thalindra."
          },
          {
            name: "Piazza Centrale",
            description: "Cuore vitale della città: bancarelle, messaggeri, locande. Punto di incontro per mercati, annunci pubblici e celebrazioni cittadine. È anche il luogo della Pozza d'Argento; qui fu ucciso Tal'Noriel."
          },
          {
            name: "Giardini di Lynthariel",
            description: "Ampie aree botaniche e serre dove crescono specie rare e piante magiche, curate dalle sacerdotesse di Thalindra. Forniscono erbe medicinali e piante rituali."
          },
          {
            name: "Torre di Velyanor",
            description: "Torre delle Staffe Serafine: punto di osservazione stellare, laboratorio magico e centro per la manutenzione delle barriere difensive arcane della città."
          },
          {
            name: "Santuario delle Radici",
            description: "Cripte antiche sotto Velarithan che custodiscono tombe degli antenati e reliquie della fondazione. Luogo sacro usato per rituali ancestrali e, occasionalmente, ricerche clandestine."
          }
        ],
        "Eventi lore": [
          '<a href="lore.html#evento-battaglia-fantasma">Battaglia Fantasma</a>',
          '<a href="lore.html#evento-esecuzione-talnoriel">Esecuzione di Tal Noriel</a>'
        ]
      }
    },
    { name: "Goldbrick", image: "../assets/goldbrick.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Khar Durim", image: "../assets/khardurim.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Laboratorio", image: "../assets/laboratorio.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Avamposto della Guardia", image: "../assets/avamposto.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Valdenor", image: "../assets/valdenorposto.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Kurk", image: "../assets/kurk.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Elbrunn", image: "../assets/elbrunn.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Isothar", image: "../assets/isothar.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Monastero di Radamir", image: "../assets/monastero.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Villaggio di Eilistrae", image: "../assets/villaggio.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Crocevia dell'Ishuriel", image: "../assets/crocevia.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Gole di Marm'Ryn", image: "../assets/gole.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Fost", image: "../assets/fost.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Northpearl", image: "../assets/northpearl.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Ethis", image: "../assets/ethis.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Luskan", image: "../assets/luskan.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Baldur's Gate", image: "../assets/baldursgate.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Waterdeep", image: "../assets/waterdeep.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Neverwinter", image: "../assets/neverwinter.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Phandalin", image: "../assets/phandalin.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Menzoberranzan", image: "../assets/menzoberranzan.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Mithral Hall", image: "../assets/mithralhall.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Velkynvelve", image: "../assets/velkynvelve.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Amn", image: "../assets/amn.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Arcipelago di Matra", image: "../assets/arcipelago.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Thay", image: "../assets/thay.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Asintoto dei Mondi", image: "../assets/asintoto.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Kardum'El", image: "../assets/kardumel.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Monti Ogal'duk", image: "../assets/ogalduk.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Calimport", image: "../assets/calimport.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Labirinto", image: "../assets/labirinto.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } },
    { name: "Aragon", image: "../assets/aragon.png", sections: { "Storia": "", "Geografia": "", "PNG chiave": "", "Eventi lore": "" } }
    // Aggiungi altri luoghi qui...
  ];

  const listEl = document.getElementById('placesList');
  const detailsEl = document.getElementById('placeDetails');
  const container = document.getElementById('container');
  const menuToggle = document.getElementById('menuToggle');

  // genera lista
  places.forEach((place, idx) => {
    const li = document.createElement('li');
    li.textContent = place.name;
    li.addEventListener('click', () => showPlace(idx));
    listEl.appendChild(li);
  });

  // utilità escape regex
  function escapeRegex(s) {
    return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  // crea un paragrafo semplice (senza evidenziazioni automatiche)
  function createParagraph(text) {
    const p = document.createElement('p');
    p.textContent = text;
    return p;
  }

  // showPlace: renderizza usando nodi DOM (paragrafi da \n\n, elenco luoghi con nome sottolineato)
  function showPlace(index) {
    const place = places[index];

    // pulisce
    detailsEl.innerHTML = '';

    // titolo e immagine
    const h1 = document.createElement('h1');
    h1.textContent = place.name;
    detailsEl.appendChild(h1);

    const img = document.createElement('img');
    img.src = place.image || '';
    img.alt = place.name;
    img.className = 'place-image';
    detailsEl.appendChild(img);

    // scorri le sezioni nell'ordine originale dell'oggetto
    for (const [title, content] of Object.entries(place.sections)) {
      const sectionDiv = document.createElement('div');
      sectionDiv.className = 'section';

      const h3 = document.createElement('h3');
      h3.textContent = title;
      sectionDiv.appendChild(h3);

      // GESTIONE SPECIALE: Luoghi Importanti come elenco con nome sottolineato
      if (title === "Luoghi Importanti") {
        if (Array.isArray(content)) {
          const ul = document.createElement('ul');
          ul.className = 'luoghi-list';
          content.forEach(item => {
            const li = document.createElement('li');
            // ogni item è {name, description}
            if (item && typeof item === 'object' && item.name) {
              const nameSpan = document.createElement('span');
              nameSpan.className = 'luogo-name';
              nameSpan.textContent = item.name;
              li.appendChild(nameSpan);

              if (item.description) {
                const desc = document.createElement('p');
                desc.className = 'luogo-desc';
                desc.textContent = item.description;
                li.appendChild(desc);
              }
            } else {
              // fallback: se è stringa
              li.appendChild(createParagraph(String(item)));
            }
            ul.appendChild(li);
          });
          sectionDiv.appendChild(ul);
        } else if (typeof content === 'string') {
          // split e render come elenco se fosse rimasta una stringa
          const rawItems = content.split(/\n{2,}|;\s+|(?<=\.)\s+(?=[A-ZÀ-Ý])/);
          const ul = document.createElement('ul');
          ul.className = 'luoghi-list';
          rawItems.forEach(raw => {
            const trimmed = raw.trim().replace(/^\./, '').trim();
            if (!trimmed) return;
            const li = document.createElement('li');
            // prova a estrarre un titolo breve fino a " — " o ":"
            let titlePart = trimmed;
            let descPart = '';
            const sepMatch = trimmed.match(/^([^—:-]+)[—:-]\s*(.+)$/);
            if (sepMatch) {
              titlePart = sepMatch[1].trim();
              descPart = sepMatch[2].trim();
            } else {
              // se la frase è lunga, prova a dividere al primo punto
              const firstDot = trimmed.indexOf('.');
              if (firstDot > 30) { // titolo piuttosto lungo? allora non tagliare
              } else if (firstDot > 0 && firstDot < 60) {
                titlePart = trimmed.slice(0, firstDot + 1).trim();
                descPart = trimmed.slice(firstDot + 1).trim();
              }
            }
            const nameSpan = document.createElement('span');
            nameSpan.className = 'luogo-name';
            nameSpan.textContent = titlePart;
            li.appendChild(nameSpan);
            if (descPart) {
              const p = document.createElement('p');
              p.className = 'luogo-desc';
              p.textContent = descPart;
              li.appendChild(p);
            }
            ul.appendChild(li);
          });
          sectionDiv.appendChild(ul);
        } else {
          const pre = document.createElement('pre');
          pre.textContent = JSON.stringify(content, null, 2);
          sectionDiv.appendChild(pre);
        }
        detailsEl.appendChild(sectionDiv);
        continue;
      }

      // Eventi lore: se è un array -> crea lista e parse degli <a> se presenti
      if (Array.isArray(content)) {
        const ul = document.createElement('ul');
        content.forEach(item => {
          const li = document.createElement('li');

          // prova a estrarre <a href="...">label</a> se l'item è una stringa HTML
          if (typeof item === 'string') {
            const match = item.match(/<a\s+href=["']([^"']+)["']\s*>([^<]+)<\/a>/i);
            if (match) {
              const a = document.createElement('a');
              a.href = match[1];
              a.textContent = match[2];
              li.appendChild(a);
              ul.appendChild(li);
              return;
            }
          }

          // fallback: testo semplice
          li.textContent = (typeof item === 'string') ? item : JSON.stringify(item);
          ul.appendChild(li);
        });
        sectionDiv.appendChild(ul);
        detailsEl.appendChild(sectionDiv);
        continue;
      }

      // le sezioni testuali (Storia/Geografia/Fazioni): split su doppio newline per creare paragrafi
      if (typeof content === 'string') {
        const paragraphs = content.split(/\n{2,}/);
        paragraphs.forEach(par => {
          const cleaned = par.trim();
          if (cleaned.length === 0) return;
          const pEl = createParagraph(cleaned);
          sectionDiv.appendChild(pEl);
        });
        detailsEl.appendChild(sectionDiv);
        continue;
      }

      // altri tipi (oggetto) -> visualizza in JSON sintetico
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(content, null, 2);
      sectionDiv.appendChild(pre);
      detailsEl.appendChild(sectionDiv);
    }

    // se siamo su schermo piccolo, chiudi automaticamente il menu per mostrare i dettagli a schermo intero
    if (window.innerWidth <= 768) {
      container.classList.add('menu-closed');
      menuToggle.setAttribute('aria-expanded', 'false');
      menuToggle.textContent = '☰ Luoghi';
    }
  }

  // toggle manuale del menu
  menuToggle.addEventListener('click', () => {
    const isClosed = container.classList.toggle('menu-closed');
    menuToggle.setAttribute('aria-expanded', isClosed ? 'false' : 'true');
    menuToggle.textContent = isClosed ? '☰ Luoghi' : '✕ Chiudi';
  });
</script>

</body>
</html>

